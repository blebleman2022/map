# ✅ DollyNav 配置完成

## 已配置的 API Keys

### 1. 高德地图 API Key
```
Key: 8254d66c3e308eded9c0b01eb6dc251c
用途: 地图搜索和显示
状态: ✅ 已配置（后端 + 前端）
```

### 2. SiliconFlow API Key (DeepSeek-R1)
```
Key: sk-kurqeuctgvrnhtpbbqlqpdyylbqwqntwfidtcjehnozaanya
模型: deepseek-ai/DeepSeek-R1-Distill-Qwen-7B
用途: 自然语言解析
状态: ✅ 已配置
```

---

## 配置文件位置

### 后端配置 - `backend/.env`
```env
# 高德地图 API Key
AMAP_API_KEY=8254d66c3e308eded9c0b01eb6dc251c

# LLM API Key (可选择其一)
# 通义千问
DASHSCOPE_API_KEY=

# 或者使用 OpenAI
OPENAI_API_KEY=

# 或者使用 SiliconFlow (DeepSeek-R1)
SILICONFLOW_API_KEY=sk-kurqeuctgvrnhtpbbqlqpdyylbqwqntwfidtcjehnozaanya

# 服务配置
HOST=0.0.0.0
PORT=8000
```

### 前端配置 - `frontend/.env.local`
```env
# 后端 API 地址
NEXT_PUBLIC_API_URL=http://localhost:8000

# 高德地图 Web API Key（前端使用）
NEXT_PUBLIC_AMAP_KEY=8254d66c3e308eded9c0b01eb6dc251c
```

---

## 环境检查结果

```
✓ Python 版本: 3.11.8
✓ 后端环境变量已配置
✓ 前端环境变量已配置
✓ 后端依赖已安装
```

---

## 🚀 启动服务

### 方式一：一键启动（推荐）
```bash
双击 start.bat
```

### 方式二：手动启动

**后端：**
```bash
cd backend
python -m venv venv
venv\Scripts\activate
pip install -r requirements.txt
python -m app.main
```

**前端：**
```bash
cd frontend
npm install
npm run dev
```

---

## 🌐 访问地址

- **前端应用**: http://localhost:3000
- **后端 API**: http://localhost:8000
- **API 文档**: http://localhost:8000/docs

---

## 🎯 LLM 优先级

系统会按以下顺序尝试使用 LLM：

1. ✅ **SiliconFlow (DeepSeek-R1)** - 已配置，优先使用
2. ⚪ 通义千问 - 未配置
3. ⚪ OpenAI - 未配置
4. ✅ **规则引擎** - 降级方案（免费）

当前配置下，系统会使用 **DeepSeek-R1** 进行自然语言解析。

---

## 🧪 测试查询

启动服务后，可以尝试以下查询：

### 基础查询
- "附近的星巴克"
- "1公里内的便利店"
- "最近的地铁站"

### 复杂查询
- "附近5公里内离地铁站最近的3个经济型酒店"
- "500米内24小时营业的药店"
- "2公里内的川菜馆"

### 品牌查询
- "附近的如家酒店"
- "最近的全家便利店"

---

## 📊 API 配额

### 高德地图
- **免费额度**: 30万次/天
- **超出后**: ¥0.5-2/千次
- **当前状态**: 免费额度充足

### SiliconFlow (DeepSeek-R1)
- **免费额度**: 具体请查看 SiliconFlow 官网
- **模型**: DeepSeek-R1-Distill-Qwen-7B
- **特点**: 推理能力强，适合复杂查询解析

---

## 🔍 功能特点

### DeepSeek-R1 的优势
1. **强大的推理能力**: 能理解复杂的自然语言查询
2. **中文优化**: 对中文理解更准确
3. **思维链**: 可能会展示思考过程（已自动提取 JSON）
4. **成本优化**: 7B 参数模型，响应快

### 系统特点
1. **智能降级**: LLM 失败时自动使用规则引擎
2. **多 LLM 支持**: 可配置多个 LLM，按优先级使用
3. **高可用性**: 即使 LLM 不可用，基本功能仍可使用

---

## ⚠️ 注意事项

### 高德地图 API Key
- 您提供的 Key 同时用于后端和前端
- 如果是 **Web 服务 Key**，前端地图可能无法显示
- 如果前端地图不显示，需要单独申请 **Web 端 JS API Key**

### 建议
如果前端地图无法显示，请：
1. 访问 https://lbs.amap.com/
2. 在同一应用下创建 **Web 端（JS API）** 类型的 Key
3. 将新 Key 填入 `frontend/.env.local` 的 `NEXT_PUBLIC_AMAP_KEY`

---

## 🐛 故障排查

### 问题 1: 前端地图不显示
**原因**: 可能使用了 Web 服务 Key 而非 JS API Key  
**解决**: 申请 Web 端 JS API Key 并更新 `frontend/.env.local`

### 问题 2: LLM 解析失败
**原因**: SiliconFlow API 调用失败  
**解决**: 系统会自动降级到规则引擎，基本功能不受影响

### 问题 3: 搜索无结果
**原因**: 高德地图 API Key 无效或配额用尽  
**解决**: 检查 Key 是否正确，查看配额使用情况

---

## 📞 下一步

1. ✅ 配置已完成
2. ✅ 环境检查通过
3. 🚀 **启动服务**: 双击 `start.bat`
4. 🌐 **访问应用**: http://localhost:3000
5. 🎯 **开始测试**: 输入查询，体验智能导航

---

**配置完成时间**: 2025-01-04  
**配置状态**: ✅ 完成  
**可用性**: ✅ 可立即使用

